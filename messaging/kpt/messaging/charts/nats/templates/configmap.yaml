---
# Source: messaging/charts/nats/templates/configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: messaging-nats-config
  namespace: messaging
  labels:
    helm.sh/chart: nats-0.17.0
    app.kubernetes.io/name: nats
    app.kubernetes.io/instance: messaging
    app.kubernetes.io/version: "2.8.0"
    app.kubernetes.io/managed-by: Helm
data:
  nats.conf: |
    # NATS Clients Port
    port: 4222

    # PID file shared with configuration reloader.
    pid_file: "/var/run/nats/nats.pid"

    ###############
    #             #
    # Monitoring  #
    #             #
    ###############
    http: 8222
    server_name:$POD_NAME
    #####################
    #                   #
    # TLS Configuration #
    #                   #
    #####################
    tls {
        cert_file: /etc/nats-certs/clients/nats-client-tls/tls.crt
        key_file:  /etc/nats-certs/clients/nats-client-tls/tls.key
    }
    ###################################
    #                                 #
    # NATS JetStream                  #
    #                                 #
    ###################################
    jetstream {
      max_mem: 1Gi
      store_dir: /data

      max_file:10Gi
    }
    ###################################
    #                                 #
    # NATS Full Mesh Clustering Setup #
    #                                 #
    ###################################
    cluster {
      port: 6222
      name: nats

      routes = [
        nats://messaging-nats-0.messaging-nats.messaging.svc.cluster.local:6222,nats://messaging-nats-1.messaging-nats.messaging.svc.cluster.local:6222,nats://messaging-nats-2.messaging-nats.messaging.svc.cluster.local:6222,
        
      ]
      cluster_advertise: $CLUSTER_ADVERTISE
      no_advertise: true

      connect_retries: 120
    }
    lame_duck_grace_period: 10s
    lame_duck_duration: 30s
    ##################
    #                #
    # Authorization  #
    #                #
    ##################
    authorization {
      token: "$2a$11$.qsDK8xtgn8BQwMgwzQhTerqlWcgt1mH8Ja6s1a2PljL5soAkqdT." # {"$kpt-set":"auth-token-bcrypt"}
    }
