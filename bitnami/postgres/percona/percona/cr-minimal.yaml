apiVersion: pg.percona.com/v2beta1
kind: PerconaPGCluster
metadata:
  name: "cluster-v1" # {"$kpt-set":"cluster_name"}
spec:
  
# if users is comment out, default user cluster2 will be created.
# if restore from s3 backup, previous users will exist with password from backup  
  users:
    - name: postgres
      password:
        type: AlphaNumeric
      databases:
        - "postgres"
      options: "SUPERUSER"
      
  image: perconalab/percona-postgresql-operator:main-ppg14-postgres
  postgresVersion: 14

  instances:
  - name: instance1
    dataVolumeClaimSpec:
      accessModes:
      - ReadWriteOnce
      resources:
        requests:
          storage: 1Gi


  backups:
    pgbackrest:
      stanza: db
      image: perconalab/percona-postgresql-operator:main-ppg14-pgbackrest
      repos:
        - name: repo1
#          schedules:
#            full: "0 0 * * 6"
#            differential: "0 1 * * 1-6"
          volume:
            volumeClaimSpec:
              accessModes:
              - ReadWriteOnce
              resources:
                requests:
                  storage: 1Gi

      global:
#        repo1-retention-full: "14"
#        repo1-retention-full-type: time
#        repo1-path: /pgbackrest/pgo/cluster-v1/repo1
        #repo1-cipher-type: aes-256-cbc
        #repo1-s3-uri-style: path
        log-level-console: info

  proxy:
    pgBouncer:
      image: perconalab/percona-postgresql-operator:main-ppg14-pgbouncer


