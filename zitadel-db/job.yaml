apiVersion: batch/v1
kind: Job
metadata:
  name: zitadel-db-job
spec:
  template:
    spec:
      containers:
      - name: yugabyte-client
        image: yugabytedb/yugabyte-client
        command: ["/home/yugabyte/bin/ysqlsh", "-h", "yb-tservers", "-c", "CREATE DATABASE zitadel"]
      restartPolicy: Never
  backoffLimit: 4
---
apiVersion: batch/v1
kind: Job
metadata:
  name: zitadel-db-user
spec:
  template:
    spec:
      containers:
        - name: yugabyte-client
          image: yugabytedb/yugabyte-client
          command: ["/home/yugabyte/bin/ysqlsh", "-h", "yb-tservers", "-c", "CREATE USER zitadel WITH PASSWORD 'zitadel'"]
      restartPolicy: Never
  backoffLimit: 4
---
apiVersion: batch/v1
kind: Job
metadata:
  name: zitadel-db-grant
spec:
  template:
    spec:
      containers:
        - name: yugabyte-client
          image: yugabytedb/yugabyte-client
          command: ["/home/yugabyte/bin/ysqlsh", "-h", "yb-tservers", "-c", "GRANT ALL ON DATABASE zitadel TO zitadel"]
      restartPolicy: Never
  backoffLimit: 4


